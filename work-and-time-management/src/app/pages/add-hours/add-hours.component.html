<app-header [title]="'Add Hours'" [momentDay]="momentDay"></app-header>

<ng-container *ngIf="(worksite$ | async) as worksite">
  <div class="address" @fadeInOut>
    <p>{{ worksite.nickname }}</p>
    <p><span>{{ worksite.streetAddress }}, </span> <span>{{ worksite.postalCode }}
      </span><span>{{ worksite.city }}</span></p>
  </div>
</ng-container>

<div class="marked-hours">
  <h4>Total marked hours for the day: </h4>
  <ng-container *ngIf="dayHours$ | async as hours">
    <ng-container *ngIf="hoursAddedMoment$ | async as hoursAdded">
      <span [@hoursAddedState]="hoursAdded === 'added' ? 'addition' : 'noAddition'"
        class="marked-hours__hours">{{ hours }}</span>
    </ng-container>
  </ng-container>
</div>

<form class="form" [formGroup]="dataForm">

  <app-hours-date-selection
    [parentForm]="dataForm"
    [controlName]="'date'"
    (showForm)="showFormToggleEmit($event)"
    [tableContent]="dayTableHours$ | async">
  </app-hours-date-selection>

  <div class="worksite-drd">
    <app-hours-dropdown
      *ngIf="showFormData"
      [defaultName]="'Worksite selection'"
      [content]="worksites$ | async"
      (itemSelection)="getItemSelectionFromDropdown($event)" 
      [activeSelection]="worksite$ | async"
      [setErrors]="showErrors && !dataForm.get('worksite').valid"></app-hours-dropdown>
  </div>

  <div class="worktype-drd">
    <app-hours-dropdown
      *ngIf="showFormData"
      [defaultName]="'Worktype selection'"
      [content]="worktypes$ | async"
      (itemSelection)="getItemSelectionFromDropdown($event)"
      [activeSelection]="worktype$ | async"
      [setErrors]="showErrors && !dataForm.get('worktype').valid"></app-hours-dropdown>
  </div>

  <app-hours-slider *ngIf="showFormData" formControlName="slider" [setErrors]="showErrors && !dataForm.get('slider').valid"></app-hours-slider>

  <div style="display: flex; justify-content: space-between; transition: 0.3s all;">
    <ng-container *ngIf="activeHours$ | async as active; else add">
      <!-- @fadeInSecondary  -->
      <button class="form__submit" type="submit" (click)="onSubmit()"
        *ngIf="showFormData">Edit</button>
        <!-- @fadeInSecondary  -->
      <button class="form__remove" style="justify-self: end;" (click)="remove()">Delete</button>
    </ng-container>
    <ng-template #add>
      <!-- @fadeInSecondary  -->
      <button class="form__submit" type="submit" (click)="onSubmit()" *ngIf="showFormData">Add</button>
    </ng-template>
  </div>  
</form>

<div class="table-container">
  <app-hours-table
    [tableHours]="dayTableHours$ | async"
    (hoursSelection)="getHoursSelectionFromTable($event)"
    [changeIndex]="setTableIndex">
  </app-hours-table>
</div>

<div class="footer"></div>
